const merge = require("webpack-merge");
const common = require("./webpack.common");
const path = require("path");
const absolutePath = path.resolve(__dirname, '../../../')

module.exports = merge(common, {
  devtool: "eval-source-map",
  output: {
    path: path.resolve(absolutePath + '/dist'),
    filename: 'static/[name].[chunkhash].js',
    publicPath: '/'
  },
  devServer: {
    contentBase: path.resolve(absolutePath + '/dist'),
    host: getLocalhost(),
    compress: true,
    open: true,
    port: 8080 //默认8080 引用后可修改
  }
});

function getLocalhost() {
  const interfaces = require('os').networkInterfaces();
  for (let devName in interfaces) {
    const iface = interfaces[devName];
    for (let i = 0; i < iface.length; i++) {
      const alias = iface[i];
      if (alias.family === 'IPv4' && alias.address !== '127.0.0.1' && !alias.internal) {
        return alias.address;
      }
    }
  }
}